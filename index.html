<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Risk Assessment Tool | Ed Garcia (NusaIT)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .brand-header { color: #2c3e50; font-weight: 700; border-bottom: 2px solid #3498db; padding-bottom: 15px; margin-bottom: 30px; }
        .card-custom { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 8px; }
        
        /* Risk Levels Colors */
        .risk-low { background-color: #d1e7dd; color: #0f5132; font-weight: bold; }
        .risk-medium { background-color: #fff3cd; color: #664d03; font-weight: bold; }
        .risk-high { background-color: #f8d7da; color: #842029; font-weight: bold; }

        .btn-nusa { background-color: #2c3e50; color: white; }
        .btn-nusa:hover { background-color: #1a252f; color: white; }
    </style>
</head>
<body>

<div class="container py-5">
    
    <div class="row mb-4">
        <div class="col-md-6">
            <h3 class="brand-header"><i class="fas fa-shield-virus text-primary"></i> IT Risk Assessment Tool</h3>
        </div>
        <div class="col-md-6 text-md-end text-muted small">
            Based on ISO 27005 Concepts<br>
            Maintained by <a href="https://nusait.com" target="_blank" class="text-decoration-none fw-bold">Ed Garcia (NusaIT)</a>
        </div>
    </div>

    <div class="card card-custom p-4 mb-4">
        <h5 class="card-title mb-3 text-primary"><i class="fas fa-plus-circle"></i> Add New Risk Entry</h5>
        <div class="row g-3">
            <div class="col-md-3">
                <label class="form-label small fw-bold">Asset Name</label>
                <input type="text" id="assetName" class="form-control" placeholder="e.g. Database Server">
            </div>
            <div class="col-md-3">
                <label class="form-label small fw-bold">Threat (Ancaman)</label>
                <input type="text" id="threat" class="form-control" placeholder="e.g. Ransomware">
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">Likelihood (1-5)</label>
                <select id="likelihood" class="form-select">
                    <option value="1">1 - Rare</option>
                    <option value="2">2 - Unlikely</option>
                    <option value="3">3 - Possible</option>
                    <option value="4">4 - Likely</option>
                    <option value="5">5 - Certain</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small fw-bold">Impact (1-5)</label>
                <select id="impact" class="form-select">
                    <option value="1">1 - Negligible</option>
                    <option value="2">2 - Minor</option>
                    <option value="3">3 - Moderate</option>
                    <option value="4">4 - Major</option>
                    <option value="5">5 - Catastrophic</option>
                </select>
            </div>
            <div class="col-md-2 d-grid align-items-end">
                <button onclick="addRisk()" class="btn btn-primary"><i class="fas fa-save"></i> Add</button>
            </div>
        </div>
    </div>

    <div class="card card-custom p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title text-secondary"><i class="fas fa-list-alt"></i> Risk Register</h5>
            <button onclick="exportToCSV()" class="btn btn-success btn-sm"><i class="fas fa-file-csv"></i> Export CSV</button>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Asset</th>
                        <th>Threat</th>
                        <th class="text-center">Likelihood</th>
                        <th class="text-center">Impact</th>
                        <th class="text-center">Score</th>
                        <th class="text-center">Level</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody id="riskTableBody">
                    </tbody>
            </table>
        </div>
        <div id="emptyState" class="text-center py-4 text-muted">
            <i class="fas fa-clipboard-list fa-3x mb-2 opacity-25"></i>
            <p>No risks added yet. Start by adding an asset above.</p>
        </div>
    </div>

    <div class="mt-5 text-center border-top pt-4">
        <p class="text-muted small">
            Disclaimer: This tool provides a preliminary quantitative assessment. 
            For a comprehensive qualitative analysis and ISO 27001 implementation, consult with experts.
        </p>
        <a href="https://nusait.com" class="btn btn-nusa btn-sm rounded-pill px-4">
            Get Professional Advice from Ed Garcia
        </a>
    </div>

</div>

<script>
    let risks = [];

    function addRisk() {
        const asset = document.getElementById('assetName').value;
        const threat = document.getElementById('threat').value;
        const likelihood = parseInt(document.getElementById('likelihood').value);
        const impact = parseInt(document.getElementById('impact').value);

        if(!asset || !threat) {
            alert("Please fill in Asset Name and Threat.");
            return;
        }

        const score = likelihood * impact;
        let level = '';
        let cssClass = '';

        // Simple Risk Matrix Logic
        if (score >= 15) { level = 'HIGH'; cssClass = 'risk-high'; }
        else if (score >= 5) { level = 'MEDIUM'; cssClass = 'risk-medium'; }
        else { level = 'LOW'; cssClass = 'risk-low'; }

        const riskItem = { id: Date.now(), asset, threat, likelihood, impact, score, level, cssClass };
        risks.push(riskItem);
        
        renderTable();
        clearForm();
    }

    function deleteRisk(id) {
        risks = risks.filter(r => r.id !== id);
        renderTable();
    }

    function renderTable() {
        const tbody = document.getElementById('riskTableBody');
        const emptyState = document.getElementById('emptyState');
        tbody.innerHTML = '';

        if (risks.length === 0) {
            emptyState.style.display = 'block';
            return;
        } else {
            emptyState.style.display = 'none';
        }

        risks.forEach(r => {
            const row = `
                <tr>
                    <td class="fw-bold">${r.asset}</td>
                    <td>${r.threat}</td>
                    <td class="text-center">${r.likelihood}</td>
                    <td class="text-center">${r.impact}</td>
                    <td class="text-center fw-bold">${r.score}</td>
                    <td class="text-center"><span class="badge ${r.cssClass}">${r.level}</span></td>
                    <td class="text-center">
                        <button onclick="deleteRisk(${r.id})" class="btn btn-outline-danger btn-sm border-0"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function clearForm() {
        document.getElementById('assetName').value = '';
        document.getElementById('threat').value = '';
        document.getElementById('likelihood').value = '1';
        document.getElementById('impact').value = '1';
    }

    function exportToCSV() {
        if (risks.length === 0) {
            alert("No data to export.");
            return;
        }
        
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Asset Name,Threat,Likelihood,Impact,Risk Score,Risk Level\n"; // Header

        risks.forEach(r => {
            csvContent += `"${r.asset}","${r.threat}",${r.likelihood},${r.impact},${r.score},${r.level}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "risk_assessment_nusait.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>
